[phases.setup]
nixPkgs = ["php82", "curl", "nodejs-20_x"]

[variables]
NODE_ENV = "production"

[phases.install]
cmds = [
  "echo 'Installing Composer...'",
  "curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer",
  "chmod +x /usr/local/bin/composer",
  "echo 'Installing PHP dependencies...'",
  "cd backend && /usr/local/bin/composer install --no-dev --optimize-autoloader || (echo 'Composer install failed!' && exit 1)",
  "echo 'Installing Node dependencies...'",
  "cd frontend && npm ci --production=false || (echo 'npm install failed!' && exit 1)",
  "echo 'Building frontend...'",
  "cd frontend && npm run build || (echo 'npm build failed!' && exit 1)",
  "echo 'Build completed successfully!'"
]

[start]
cmd = "chmod +x start.sh && ./start.sh"

